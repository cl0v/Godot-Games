[gd_scene load_steps=6 format=2]

[ext_resource path="res://New Piskel-3.png" type="Texture" id=1]
[ext_resource path="res://scenes/Joystick.tscn" type="PackedScene" id=2]
[ext_resource path="res://scenes/158894__primeval-polypod__rocket-launch.wav" type="AudioStream" id=3]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

const MAX_SPEED = 400
const ACCELERATION_FRICTION = 200
const BREAK_FRICTION = 200

signal dead

onready var joystick = $CanvasLayer/Joystick


var input_vector = Vector2.ZERO
var motion = Vector2.ZERO

func _physics_process(delta):
	
	input_vector = joystick.get_value()
	
	if input_vector != Vector2.ZERO:
		play_audio()
		$CPUParticles2D.emitting = true
		rotation = input_vector.angle() + deg2rad(-90)
		motion = motion.move_toward(input_vector * MAX_SPEED, ACCELERATION_FRICTION * delta)
	else:
		$AudioStreamPlayer.stop()
		$CPUParticles2D.emitting = false
		motion = motion.move_toward(Vector2.ZERO, BREAK_FRICTION * delta)
	
	motion = move_and_slide(motion)
	
	for i in get_slide_count():
		var collision = get_slide_collision(i)
		if collision.collider.is_in_group(Game.GROUPS.ENVIRONMENT):
			emit_signal(\"dead\")
			motion = Vector2.ZERO

	
func set_dir_vector(dir):
	input_vector = dir


func play_audio():
	if !$AudioStreamPlayer.playing:
		$AudioStreamPlayer.play()

	
"

[sub_resource type="Gradient" id=2]
offsets = PoolRealArray( 0, 0.480132, 1 )
colors = PoolColorArray( 0.695312, 0.091002, 0.091002, 1, 0.941406, 0.937785, 0.93178, 1, 0.905478, 0.953125, 0.0818635, 1 )

[node name="Player" type="KinematicBody2D"]
collision_layer = 2
collision_mask = 7
script = SubResource( 1 )

[node name="CPUParticles2D" type="CPUParticles2D" parent="."]
position = Vector2( -0.422188, -3.92636 )
emitting = false
amount = 30
speed_scale = 2.03
local_coords = false
direction = Vector2( 0, -1 )
spread = 55.65
gravity = Vector2( 0, 0 )
initial_velocity = 32.25
color_ramp = SubResource( 2 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( -0.522919, 0 )
texture = ExtResource( 1 )

[node name="Direction" type="Sprite" parent="Sprite"]
modulate = Color( 0.196078, 0.223529, 0.647059, 1 )
position = Vector2( 0.462892, 30.6308 )
scale = Vector2( 0.3, 0.3 )
texture = ExtResource( 1 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="."]
polygon = PoolVector2Array( -14, -10, 13, -10, 0, 15.5 )

[node name="Camera2D" type="Camera2D" parent="."]
current = true
process_mode = 0
smoothing_enabled = true

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Joystick" parent="CanvasLayer" instance=ExtResource( 2 )]
position = Vector2( 86.5406, 316.229 )
scale = Vector2( 0.449467, 0.449467 )

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 3 )
volume_db = -28.948
